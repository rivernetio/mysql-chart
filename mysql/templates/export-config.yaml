apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}
  labels:
    chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    release: {{ .Release.Name }}
data:
  grafana-ecp-mysql-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"grafana-piechart-panel","name":"Pie Chart","version":"1.1.5"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":""}],"annotations":{"list":[]},"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":"250px","panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":1,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":4,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"mysql_global_status_uptime{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"","metric":"mysql_up","refId":"A","step":4}],"thresholds":"","title":"服务启动时间","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"aliasColors":{},"cacheTimeout":null,"combine":{"label":"Others","threshold":0},"datasource":"prometheus","fontSize":"50%","format":"short","id":2,"interval":null,"legend":{"show":true,"values":true},"legendType":"On graph","links":[],"maxDataPoints":3,"nullPointMode":"connected","pieType":"pie","span":4,"strokeWidth":1,"targets":[{"expr":"mysql_global_status_connections{release=\"$releaseName\"}-mysql_global_status_aborted_connects{release=\"$releaseName\"}-mysql_global_status_aborted_clients{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"正常连接","refId":"A","step":240},{"expr":"mysql_global_status_aborted_connects{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"失败连接","refId":"B","step":240},{"expr":"mysql_global_status_aborted_clients{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"中断连接","refId":"C","step":240}],"title":"连接状态","type":"grafana-piechart-panel","valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":3,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":4,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"targets":[{"expr":"mysql_global_status_max_used_connections{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"","refId":"A","step":4}],"thresholds":"","title":"并发连接数","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"irate(mysql_global_status_bytes_sent{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"","refId":"A","step":2},{"expr":"irate(mysql_global_status_bytes_received{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"服务IO","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"fill":1,"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"rightSide":true,"show":false,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"count  (mysql_global_status_commands_total{release=\"$releaseName\"}) by (command)","intervalFactor":2,"legendFormat":"","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Commands","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":null,"multi":false,"name":"releaseName","options":[],"query":"label_values(mysql_exporter_collector_duration_seconds{chart=\"mysql-5.7.20\"},release)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"ecp_mysql_metrics","version":1}}
